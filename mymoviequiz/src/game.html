<!doctype html>
<html lang="en">
  <head>
    <title>MyMoviesQuiz - Choose the game mode</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
    <link rel="stylesheet" href="css/main.css">
    <style type="text/css" media="screen">

      .game-info {
        border-color: rgb(90,90,0) !important;
        font-size: 1.2em;
      }

      img {
        box-shadow: 4px 4px #CCC;
      }

      /* img:hover {
       position:absolute;
       top:-25%;
       left:-0.5%;
       width:auto;
       height:auto;
       display:block;
       z-index:999;
       box-shadow: none;
       border: 2px solid rgb(90,80,50);
      } */

      .question {
        font-family: Tauri, sans-serif;
        font-size: 1.6em;
      }

      .answer-button {
        font-family: Tauri, sans-serif;
        font-size: 1.6em;
        text-align: center;
        padding: 12px 5px;
        margin: 10px;
        border: 1px solid rgb(80,90,80);
        box-shadow: 4px 4px rgb(100,80,90);
      }

      .answer-button:hover {
        cursor: pointer;
        background-color: rgba(0,0,0,0.6) !important;
      }

      .answer-button:active {
        transform: scale(0.9);
      }

      #answer-button1 {
        background-color: yellow;
      }

      #answer-button2 {
        background-color: lightgreen;
      }

      #answer-button3 {
        background-color: lightblue;
      }

      #answer-button4 {
        background-color: cyan;
      }

      .progress {
        margin-top: 30px;
      }



    </style>
  </head>
  <body onload="loadGameData()">

    <nav class="navbar navbar-expand-md navbar-light d-none">
      <!-- My Quiz Logo -->
      <div class="logo">
        <div class="logo-quiz">
          <a href="index.html">My Movie Quiz</a>
        </div>
      </div>
      <!-- logo end -->
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarContent">
        <div class="mr-auto"></div>
        <form class="form-inline d-inline-flex" class="" action="index.html" method="post">
          <input type="text" class="form-control form-control-sm mr-sm-2" id="txtUsername" name="txtUsername" aria-label="Username Login" placeholder="Username" disabled>
          <input type="password" class="form-control form-control-sm" id="txtPassword" name="txtPassword" aria-label="Password Login" placeholder="Password" disabled>
          <button type="submit" class="btn btn-sm btn-success ml-2" id="btnSubmit" name="btnSubmit" disabled>Login</button>
        </form>
      </div>
    </nav>

    <div class="container-fluid px-3 py-3 bg-light">
      <div class="container border rounded px-2 py-2 question-container" style="box-shadow:1px 1px #CCC;">
        <div class="row">
          <div class="col-lg-3">
            <!-- Game info container  -->
            <div class="w-100 px-2 py-2 border rounded game-info">
              <label for="gameMode">Game Mode:
                <span id="gameMode">Random</span>
              </label>
              <br />
              <label for="gameNumQuestion">Question:
                <span id="gameNumQuestion" value="0"></span>
              </label>
              <br />
              <label for="gamePack">Pack:
                <span id="gamePack" value="0"></span>
              </label>
            </div>
          </div>
      <!-- Game Container -->

          <div class="col-lg-7">
            <div id="imgContainer" class="container w-50 text-center">
              <!-- Image/Picture Question -->
                <!-- <img id="imgMovie" class="img-fluid rounded" width="200" height="200" src="/mymoviequiz/src/images/ricky-turner-445257.jpg" alt="Movie Image"> -->
            </div>
          </div>
          <div class="col-lg-12 text-center mt-3">
            <!-- Question -->
            <p id="question" class="question">
              <!-- In the movie 'Two hearts as one' the main character must decide between his lovely wife and another figure that has appeared years after the couple's marriage. True or false? -->
            </p>
            <!-- What is the name of the movie theatre in the picture above? -->
          </div>

          <!-- Answers container -->
          <div class="col-lg-6">
            <div id="answer-button1" class="answer-button rounded">
              <span id="answer1" value="0"></span>
            </div>
          </div>
          <div class="col-lg-6">
            <div id="answer-button2" class="answer-button rounded">
              <span id="answer2" value="0"></span>
            </div>
          </div>

          <div class="col-lg-6">
            <div id="answer-button3" class="answer-button rounded">
              <span id="answer3" value="0"></span>
            </div>
          </div>
          <div class="col-lg-6">
            <div id="answer-button4" class="answer-button rounded">
              <span id="answer4" value="0"></span>
            </div>
          </div>

          <!-- Progress bar -->
          <div class="col-lg-12">
            <div class="progress" style="display:none;">
              <div class="progress-bar progress-bar-striped font-weight-bold" id="countdownBar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
          </div>

        </div>
      </div>
    </div>





      <!-- Optional JavaScript -->
      <!-- jQuery first, then Popper.js, then Bootstrap JS -->
      <!-- This version below does not support AJAX -->
      <!-- <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script> -->
      <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
      <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
      <script type="text/javascript">

        // variables to control animation and general game
        var interval;
        var totalScore = 0;
        const MAX_TIME = 15; //Max time progress bar
        const QUESTION_SCORE = 1.0;
        const BONUS_MULTIPLIER = 3.0;
        var milisecond = (MAX_TIME / 0.1);
        var widthProgress = (milisecond / 1000);
        var colorProgress = {
          "red":0,
          "green":255,
          "blue":0
        };


        var gameArr = [
          [
            {
              sessionID:"50",
              question:"What is the name of actor known as 'Blondie' in the classic western 'The God, the Bad and the Ugly'?",
              questionID:"100",
              answer:[
                {
                  "1":"Matt Damon",
                  "2":"Clint Eastwood",
                  "3":"Eli Wallach",
                  "4":"Sylvester Stallone"
                }
              ],
              correct:"2",
              score:0,
              image:"../src/images/cowboy-2377228_640.png",
              mode:"Random"
            },
            {
              sessionID:"50",
              question:"What's the name of this Jame's Cameron movie winner of 11 eleven Oscars including best picture?",
              questionID:"100",
              answer:[
                {
                  "1":"Avatar",
                  "2":"Titanic",
                  "3":"Green fried tomatoes",
                  "4":"Aliens"
                }
              ],
              correct:"2",
              score:0,
              image:"../src/images/tita_poster.jpg",
              mode:"Random"
            },
            {
              sessionID:"50",
              question:"What is the name of actor who played John Rambo?",
              questionID:"100",
              answer:[
                {
                  "1":"Leonardo DiCaprio",
                  "2":"Sylvester Stallone",
                  "3":"Arnold Schwarzenegger",
                  "4":"Sean Penn"
                }
              ],
              correct:"2",
              score:0,
              image:"",
              mode:"Random"
            }
          ]

          ,[
            {
              sessionID:"50",
                question:"What is the name of starfreighter which was destroyed by officer Ripley in 1979 Alien?",
              questionID:"100",
              answer:[
                {
                  "1":"USS Sulaco",
                  "2":"USCSS Nostromo",
                  "3":"SSV Normandy",
                  "4":"Nebuchadnezzar"
                }
              ],
              correct:"2",
              score:0,
              image:"../src/images/Alien_movie_poster.jpg",
              mode:"Random"
            },
            {
              sessionID:"50",
              question:"What's the name of this 007 James Bond arch enemy and head of SPECTRE?",
              questionID:"100",
              answer:[
                {
                  "1":"Le Chiffre",
                  "2":"Ernst Stavro Blofeld",
                  "3":"Oddjob",
                  "4":"Dr. No"
                }
              ],
              correct:"2",
              score:0,
              image:"../src/images/Blofeld.jpg",
              mode:"Random"
            },
            {
              sessionID:"50",
              question:"What is the name of Fox Mulder's partner in X-Files series played by Gillian Anderson?",
              questionID:"100",
              answer:[
                {
                  "1":"Sigourney Weaver",
                  "2":"Dana Scully",
                  "3":"Carrie-Anne Moss",
                  "4":"Scarlett Johansson"
                }
              ],
              correct:"2",
              score:0,
              image:"../src/images/xfiles.jpg",
              mode:"Random"
            }
          ]
        ];

        var packLength = gameArr[0].length;
        var numTotalPack = gameArr.length;
        var currentPack = 0;
        var currentQuestion = 0;

        function loadGameData(){

          // Update game info
          $('#gameMode').text(gameArr[currentPack][currentQuestion]["mode"]);
          $('#gameNumQuestion').attr("value",currentQuestion);
          $('#gameNumQuestion').text((currentQuestion + 1) + "/" + packLength);
          $('#gamePack').attr("value", currentPack);
          $('#gamePack').text(currentPack + 1 + "");

          //Load image, if exists
          changeImg(gameArr[currentPack][currentQuestion]["image"]);

          //Load question
          $('#question').empty().text(gameArr[currentPack][currentQuestion]["question"]);

          //Load data into button
          loadDataButton();

          // update question
          currentQuestion++;
          if(currentQuestion >= packLength && (currentPack + 1) > numTotalPack){
            // callMethodToFinalize();
            return;
            $('.anser-button').off('click');
          } else if(currentQuestion >= packLength){
            currentQuestion = 0;
            currentPack++;
          }

          // wait a few seconds before starts countdown
          window.setTimeout(startCountdown, 3000);
        }

        function initColors(){
          colorProgress = {
            "red":0,
            "green":255,
            "blue":0
          };
        }

        function initProgressBar(){
          initColors();
          $('.progress').show();
          $('#countdownBar').text("");
          $('#countdownBar').removeAttr('style');
          $('#countdownBar').attr({
            "aria-valuenow":"0",
            "aria-valuemin":"0",
            "aria-valuemax":"100",
            "width":"0"
          });
        }
        var startTime;
        function startCountdown(){
          startTime = new Date(); //[MODIFY] Change this to get the time from the server
          clearInterval(interval);
          initProgressBar();
          interval = setInterval("updateProgress()", milisecond);
        }

        function updateProgress(){
          var valueNow = parseFloat($('#countdownBar').attr("aria-valuenow"));
          valueNow += widthProgress;
          var colorRate = 5;

          //Adjust the color red=0, green=255
          colorProgress["red"] += (colorProgress["red"] < 255) ? colorRate:0;
          colorProgress["green"] -= (colorProgress["green"] > 0  && colorProgress["red"] == 255) ? colorRate:0;

          //Verifiy discrepancy between start time and now, if higher than total
          //allowed seconds, the countdown stops, i.g. user minimizes the browser
          //
          var timeEllapsed = ((new Date().getTime() - startTime.getTime()) / 1000);
          if(timeEllapsed >= MAX_TIME) {
            //Changes the time to the maximum allowed time and the final color as pure red
            valueNow = (MAX_TIME + 1);
            colorProgress["red"] = 255;
            colorProgress["green"] = 0;
            colorProgress["blue"] = 0;
          }

          $('#countdownBar').attr({
            "aria-valuenow":valueNow,
            "style":"width:" + (valueNow / widthProgress) + "%;background-color:rgb("
            + colorProgress["red"] + ","
            + colorProgress["green"] + ","
            + colorProgress["blue"] + ")"
          });

          // verify if the counter reached the end
          if(valueNow > MAX_TIME){
            clearInterval(interval);
            $('#countdownBar').empty().text("No Bonus Points Available");
          }
        }

        function loadDataButton(){

          //Choose the button randomically
          var answerArr = gameArr[currentPack][currentQuestion]["answer"][0];
          var nums = [1,2,3,4];
          for(var key in answerArr) {
            var y = Math.floor((Math.random() * nums.length));
            var index = nums.splice(y,1)[0];
            var answerButton = "answer" + index;
            var option = answerArr[key];

            $("#answer-button" + index).attr("value",key);
            if(option.length > 30){
              $("#answer-button" + index).css({
                "font-size":"1.2em",
                "height":"80%"
              });
            } else {
              $("#answer-button" + index).removeAttr('style');
            }
            $("#" + answerButton).text(option);
          }
        }

        function changeImg(imgSrc){
          /*Change the image, when applicable, clears the container and
          inserts the new image in it.*/

          // Clears the container either theres an image or not
          $('#imgContainer').empty();

          // If there's no image, create an empty container
          if(imgSrc.length == 0){
            return;
          }

          var element = document.createElement("img");
          var spec = {
              "id":"imgMovie",
              "class":"img-fluid rounded",
              "src":imgSrc,
              "alt":"Movie Image",
              "width":"200",
              "height":"200"
            };

          $('#imgContainer').append(
            $(element).attr(spec));
        }



        $(document).ready(function() {
          var gameType = window.location.hash;
          // if(gameType == "#btnRandom"){
          //   alert('This is a random game');
          // } else {
          //   alert('Another Game');
          // }
          var hour = new Date();

          function stopProgress(){
            //Stop the countdown
            clearInterval(interval);
            initProgressBar();
          }

          function verifyAnswer(answered){
            var correctAnswer = gameArr[currentPack][currentQuestion]["correct"];
            var correct = false;

            if(answered == correctAnswer){
              var bonusRate = $('#countdownBar').attr("aria-valuenow");
              var score = QUESTION_SCORE + (BONUS_MULTIPLIER * ((MAX_TIME - bonusRate) / MAX_TIME));
              gameArr[currentPack][currentQuestion]["score"] = score;
              totalScore += score;
              correct = true;
            }

            return correct;
          }

          function blinkContainerAnswer(correct){
            var originalColor = $('.question-container').css('background-color');
            var color;
            if(correct){
              color = "green";
            } else {
              color = "red";
            }
            $('.progress').hide();
            for(var x = 0; x < 2; x++){
              $('.question-container').animate({backgroundColor:color}, 200);
              $('.question-container').animate({backgroundColor:originalColor}, 50);
            }
          }

          $('.answer-button').click(function(){

            var correct = verifyAnswer($(this).attr("value"));
            stopProgress();
            blinkContainerAnswer(correct);
            window.setTimeout(loadGameData, 1000);

          });

        });

      </script>
    </body>
  </html>
